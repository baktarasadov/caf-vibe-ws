(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("@babel/runtime/helpers/asyncToGenerator");var r=e.n(t);const n=require("@babel/runtime/regenerator");var s=e.n(n);const i=require("dotenv");(0,i.config)(),(0,i.config)({path:".env",override:!0}),require("express-async-errors");const o=require("http"),u=require("swagger-jsdoc");var a=e.n(u);const c=require("swagger-ui-express");var p=e.n(c),f=a()({definition:{openapi:"3.0.0",info:{title:"CAF-Vibe Coffee Shop API",version:"1.0.0",description:"CAF-Vibe Coffee Shop API documentation"},servers:[{url:"http://localhost:5000"}]},apis:["./src/api/*.js"]});const l=require("@babel/runtime/helpers/toConsumableArray");var h=e.n(l);const d=require("@babel/runtime/helpers/classCallCheck");var v=e.n(d);const y=require("@babel/runtime/helpers/createClass");var m=e.n(y),g=new(function(){return m()((function e(){v()(this,e),this.dependencies={}}),[{key:"register",value:function(e,t,r){if("string"!=typeof e||!Array.isArray(t)||"function"!=typeof r)throw new Error("Invalid argument");this.dependencies[e]={dependencies:t,func:r}}},{key:"get",value:function(e){var t=this;if(!this.dependencies[e])throw new Error("Dependency not found: ".concat(e));var r=this.dependencies[e],n=r.dependencies,s=r.func,i=n.map((function(e){return t.get(e)}));return s.apply(void 0,h()(i))}}])}());const w=require("@babel/runtime/helpers/possibleConstructorReturn");var b=e.n(w);const k=require("@babel/runtime/helpers/getPrototypeOf");var S=e.n(k);const x=require("@babel/runtime/helpers/inherits");var R=e.n(x),O=function(){return m()((function e(t){v()(this,e),this.model=t}),[{key:"create",value:function(e){return this.model.create(e)}},{key:"update",value:function(e,t){return this.model.findByIdAndUpdate(e,t,{new:!0})}},{key:"delete",value:function(e){return this.model.findByIdAndDelete(e)}},{key:"findById",value:function(e){return this.model.findById(e)}},{key:"findAll",value:function(){return this.model.find()}},{key:"findOne",value:function(e){return this.model.findOne(e)}},{key:"find",value:function(e){return this.model.find(e)}},{key:"count",value:function(e){return this.model.countDocuments(e)}},{key:"aggregate",value:function(e){return this.model.aggregate(e)}},{key:"createMany",value:function(e){return this.model.insertMany(e)}},{key:"updateMany",value:function(e,t){return this.model.updateMany(e,t)}},{key:"bulkWrite",value:function(e){return this.model.bulkWrite(e)}},{key:"upsert",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",this.create(r));case 5:return e.abrupt("return",this.update(n._id,r));case 6:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e}();const q=require("mongoose");var C=e.n(q),E=new(C().Schema)({email:{type:String,trim:!0,required:!0},phoneNumber:{type:String}},{_id:!1});const I=new q.Schema({code:{type:String,required:!0},expiresAt:{type:Date,required:!0},verified:{type:Boolean,default:!1}},{_id:!1});var T=new q.Schema({fullName:{type:String,required:!0,trim:!0},profileImage:{type:String},password:{type:String,required:!0,trim:!0},contact:E,emailCodeVerification:{type:I,required:!1},passwordResetCodeVerification:{type:I,required:!1},role:{type:q.Schema.Types.Number,ref:"Role",required:!0}},{collection:"users",timestamps:!0});const F=C().model("User",T);function j(e,t,r){return t=S()(t),b()(e,_()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_=function(){return!!e})()}var N=function(e){function t(){return v()(this,t),j(this,t,[F])}return R()(t,e),m()(t)}(O);const A=require("bcrypt");function B(e){return P.apply(this,arguments)}function P(){return(P=r()(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.genSalt(10);case 2:return r=e.sent,e.abrupt("return",A.hash(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(){return m()((function e(t,r){v()(this,e),this.userRepository=t,this.roleRepository=r}),[{key:"createAdmin",value:(e=r()(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userRepository.findOne({role:1});case 2:if(e.sent){e.next=8;break}return e.next=6,B("baktaradmin");case 6:return t=e.sent,e.abrupt("return",this.userRepository.create({email:"baktaradmin@gmail.com",fullName:"baktar admin",password:t,role:1}));case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e}();const M=require("http-status-codes");var H=function(){function e(t){v()(this,e),this.success=t.success,this.status=t.status,this.message=t.message,this.data=t.data,this.details=t.details}return m()(e,null,[{key:"success",value:function(t){var r=t.status,n=void 0===r?M.StatusCodes.OK:r,s=t.message,i=t.data;return new e({success:!0,status:n,message:s||(0,M.getReasonPhrase)(n),data:i})}},{key:"error",value:function(t){var r=t.message,n=t.status,s=void 0===n?M.StatusCodes.BAD_REQUEST:n,i=t.details,o=void 0===i?null:i;return new e({success:!1,status:s,message:r||(0,M.getReasonPhrase)(s),details:o})}}])}(),U=function(){return m()((function e(t){v()(this,e),this.userRepository=t}),[{key:"create",value:(i=r()(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findByEmail(t.contact.email);case 2:if(!e.sent){e.next=5;break}throw new H.error({message:"Email is already in use",status:M.StatusCodes.CONFLICT});case 5:return e.next=7,B(t.password);case 7:return t.password=e.sent,e.abrupt("return",this.userRepository.create(t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"findByEmail",value:(n=r()(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userRepository.findOne({"contact.email":t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"findById",value:(t=r()(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userRepository.findById(t);case 2:if(r=e.sent){e.next=5;break}throw H.error({status:M.StatusCodes.NOT_FOUND,message:"User not found!"});case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"update",value:(e=r()(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findById(t);case 2:return e.abrupt("return",this.userRepository.update(t,r));case 3:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t,n,i}(),W="user-service",J="user-repository";g.register(J,[],(function(){return new N})),g.register("user-seeder",[J],(function(e){return new D(e)})),g.register(W,[J],(function(e){return new U(e)}));var K=m()((function e(t){var r=t.contact,n=t.location,s=t.title,i=t.copyright,o=t.openingDay,u=t.openingHour,a=t.socialMedia;v()(this,e),Object.assign(this,{contact:r,location:n,title:s,copyright:i,openingDay:o,openingHour:u,socialMedia:a})})),L=function(){return m()((function e(t){v()(this,e),this.foooterService=t}),[{key:"find",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.foooterService.find();case 2:n=e.sent,r.success({message:"Find Footer successfully!",status:M.StatusCodes.OK,data:n?new K(n):null});case 4:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e}(),V=new(C().Schema)({href:{type:String,require:!0},title:{type:String},url:{type:String,required:!0},publicId:{type:String,required:!0},type:{type:String},size:{type:Number}},{_id:!1}),G=new q.Schema({contact:E,location:{type:String,required:!0},title:{type:String,required:!0},copyright:{type:String,required:!0},openingDay:{type:String,required:!0},openingHour:{type:String,required:!0},socialMedia:[V]},{collection:"footer",timestamps:!0});const Q=C().model("Footer",G);function X(e,t,r){return t=S()(t),b()(e,z()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(z=function(){return!!e})()}var Y=function(e){function t(){return v()(this,t),X(this,t,[Q])}return R()(t,e),m()(t)}(O),Z=function(){return m()((function e(t,r){v()(this,e),this.footerRepository=t,this.storageService=r}),[{key:"create",value:(n=r()(s().mark((function e(t,r){var n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.footerRepository.findAll();case 2:if(n=e.sent,i=[],!(n.length>0)){e.next=6;break}throw H.error({status:M.StatusCodes.CONFLICT,message:"Footer already exists !"});case 6:if(!(r&&r.length>0)){e.next=10;break}return e.next=9,this.storageService.uploadFiles(r);case 9:i=e.sent;case 10:return t.socialMedia=i,e.abrupt("return",this.footerRepository.createFooter(t));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"find",value:(t=r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.footerRepository.findAll()[0]);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"update",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.footerRepository.find()[0];case 2:if(n=e.sent){e.next=5;break}throw H.error({status:M.StatusCodes.NOT_FOUND,message:"Footer not found !"});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t,n}(),$="footer-service",ee="footer-repository",te="footer-controller";g.register(ee,[],(function(){return new Y})),g.register($,[ee],(function(e){return new Z(e)})),g.register(te,[$],(function(e){return new L(e)}));const re=require("@babel/runtime/helpers/defineProperty");var ne=e.n(re);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){ne()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var oe=new q.Schema({role:{type:String,unique:!0,required:!0,trim:!0}},{collection:"roles",versionKey:!1}).plugin((function(e,t){if(!t.incField)throw new Error("Please specify incField!");var n={type:Number};"_id"!==t.incField&&(n=ie(ie({},n),{},{unique:!0})),e.add(ne()({},t.incField,n)),e.pre("save",(function(e){var r=this;this.isNew?this.constructor.findOne({},{},{sort:ne()({},t.incField,-1)}).then((function(n){r[t.incField]=n?n[t.incField]+1:1,e()})):e()})),e.pre("insertMany",function(){var e=r()(s().mark((function e(r,n){var i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({},{},{sort:ne()({},t.incField,-1)});case 2:i=e.sent,o=i?i[t.incField]:0,n.forEach((function(e,r){e[t.incField]=o+r+1})),r();case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}())}),{incField:"_id"});const ue=C().model("Role",oe);function ae(e,t,r){return t=S()(t),b()(e,ce()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ce=function(){return!!e})()}var pe=function(e){function t(){return v()(this,t),ae(this,t,[ue])}return R()(t,e),m()(t)}(O),fe=[{role:"admin"},{role:"user"}],le=function(){return m()((function e(t){v()(this,e),this.roleRepository=t}),[{key:"createRoles",value:(e=r()(s().mark((function e(){var t,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roleRepository.findAll();case 2:if(t=e.sent,r=t.map((function(e){return e.role})),!((n=fe.filter((function(e){return!r.includes(e.role)}))).length>0)){e.next=8;break}return e.next=8,this.roleRepository.createMany(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e}(),he="role-repository";g.register(he,[],(function(){return new pe})),g.register("role-seeder",[he],(function(e){return new le(e)}));var de=m()((function e(t){var r=t.email,n=t.phoneNumber;v()(this,e),Object.assign(this,{email:r,phoneNumber:n})})),ve=m()((function e(t){v()(this,e),this.fullName=t.fullName,this.profileImage=t.profileImage,this.role=t.role,this.contact=new de(t.contact)})),ye=m()((function e(t){v()(this,e),this.access=t.accessToken,this.refresh=t.refreshToken})),me=m()((function e(t){v()(this,e),this.token=new ye(t.token),this.user=new ve(t.user)})),ge=function(){return m()((function e(t){v()(this,e),this.authService=t}),[{key:"register",value:(t=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.register(t.body);case 2:n=e.sent,r.success({message:"User register success",status:M.StatusCodes.CREATED,data:new me(n)});case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"login",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.login(t.body);case 2:n=e.sent,r.success({message:"User Login  success",status:M.StatusCodes.OK,data:new me(n,"")});case 5:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t}();const we=require("jsonwebtoken");var be=e.n(we),ke=function(e,t,r){return be().sign(e,t,{expiresIn:r,algorithm:"HS512"})},Se={jwt:{algorithm:process.env.JWT_ALGORITHM,accessSecret:process.env.JWT_ACCESS_SECRET,accessExpiresIn:process.env.JWT_ACCESS_EXPIRES_IN,refreshSecret:process.env.JWT_REFRESH_SECRET,refreshExpiresIn:process.env.JWT_REFRESH_EXPIRES_IN}},xe=function(){return m()((function e(t){v()(this,e),this.userService=t}),[{key:"register",value:(t=r()(s().mark((function e(t){var r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.role=2,e.next=3,this.userService.create(t);case 3:return r=e.sent,n={sub:r._id,email:r.contact.email},e.next=7,this.createToken(n);case 7:return i=e.sent,e.abrupt("return",{user:r,token:i});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"createToken",value:(e=r()(s().mark((function e(t){var r,n,i,o,u,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=Se.jwt).accessSecret,i=r.accessExpiresIn,o=r.refreshSecret,u=r.refreshExpiresIn,e.next=3,ke(t,n,i);case 3:return a=e.sent,e.next=6,ke(t,o,u);case 6:return c=e.sent,e.next=9,this.userService.update(t.sub,{token:{refresh:c}});case 9:return e.abrupt("return",{accessToken:a,refreshToken:c});case 10:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),Re="auth-controller",Oe="auth-service";g.register(Oe,[W],(function(e){return new xe(e)})),g.register(Re,[Oe],(function(e){return new ge(e)}));const qe=require("cookie-parser");var Ce=e.n(qe);const Ee=require("cors");var Ie=e.n(Ee);const Te=require("express");var Fe=e.n(Te);const je=require("express-rate-limit");var _e=Fe().Router(),Ne="/auth",Ae=g.get(Re);_e.post("".concat(Ne,"/login"),(function(e,t){return Ae.login(e,t)})),_e.post("".concat(Ne,"/register"),(function(e,t){return Ae.register(e,t)}));const Be=_e;var Pe=Fe().Router(),De=g.get(te);Pe.get("".concat("/footers"),(function(e,t){return De.find(e,t)}));const Me=Pe;var He="/api/v1";const Ue=require("@babel/runtime/helpers/wrapNativeSuper");function We(e,t,r){return t=S()(t),b()(e,Je()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function Je(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Je=function(){return!!e})()}var Ke=function(e){function t(e,r){var n;return v()(this,t),(n=We(this,t,[e])).statusCode=r,n}return R()(t,e),m()(t)}(e.n(Ue)()(Error));var Le=Fe()();Le.use((0,je.rateLimit)({windowMs:6e5,limit:100,standardHeaders:"draft-6",legacyHeaders:!1,message:"Too many requests"})),Le.set("trust proxy",1),Le.use(Ce()()),Le.use(Fe().urlencoded({extended:!0})),Le.use(Fe().json()),Le.use(Ie()()),Le.disable("x-powered-by"),Le.use((function(e,t,r){t.success=function(e){t.status(e.status||M.StatusCodes.OK).json(H.success(e))},t.error=function(e){t.status(e.status||M.StatusCodes.BAD_REQUEST).json(H.error(e))},r()})),Le.use("/api-docs",p().serve,p().setup(f)),Le.use(He,Me),Le.use(He,Be),Le.use((function(e,t,r,n){return e instanceof Ke?r.status(e.statusCode||400).json({success:!1,message:e.message}):(n(),e instanceof H?r.error(e):r.status(500).json({success:!1,message:e.message||"Internal Server Error!"}))}));const Ve=Le;function Ge(){return Qe.apply(this,arguments)}function Qe(){return(Qe=r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C().connect(process.env.CONNECTION_STRING);case 3:console.log("MongoDB Connected"),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.error("MongoDB Connection Error:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var Xe=function(){var e=r()(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new D(g.get(J)),r=new le(g.get(he)),e.next=4,r.createRoles();case 4:return e.next=6,Promise.all([t.createAdmin()]);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=(0,o.createServer)(Ve),Ye=process.env.PORT;r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge();case 2:return e.next=4,Xe();case 4:ze.listen(Ye,r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Server is running: http://localhost:".concat(Ye));case 1:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e)})))()})();
//# sourceMappingURL=build.js.map