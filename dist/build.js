(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("@babel/runtime/helpers/asyncToGenerator");var r=e.n(t);const n=require("@babel/runtime/regenerator");var s=e.n(n);const i=require("dotenv");(0,i.config)(),(0,i.config)({path:".env",override:!0}),require("express-async-errors");const o=require("http"),u=require("swagger-jsdoc");var a=e.n(u);const c=require("swagger-ui-express");var p=e.n(c),f=a()({definition:{openapi:"3.0.0",info:{title:"CAF-Vibe Coffee Shop API",version:"1.0.0",description:"CAF-Vibe Coffee Shop API documentation"},servers:[{url:"http://localhost:5000"}]},apis:["./src/api/*.js"]});const l=require("@babel/runtime/helpers/toConsumableArray");var h=e.n(l);const d=require("@babel/runtime/helpers/classCallCheck");var v=e.n(d);const y=require("@babel/runtime/helpers/createClass");var m=e.n(y),g=new(function(){return m()((function e(){v()(this,e),this.dependencies={}}),[{key:"register",value:function(e,t,r){if("string"!=typeof e||!Array.isArray(t)||"function"!=typeof r)throw new Error("Invalid argument");this.dependencies[e]={dependencies:t,func:r}}},{key:"get",value:function(e){var t=this;if(!this.dependencies[e])throw new Error("Dependency not found: ".concat(e));var r=this.dependencies[e],n=r.dependencies,s=r.func,i=n.map((function(e){return t.get(e)}));return s.apply(void 0,h()(i))}}])}());const w=require("@babel/runtime/helpers/possibleConstructorReturn");var b=e.n(w);const k=require("@babel/runtime/helpers/getPrototypeOf");var S=e.n(k);const x=require("@babel/runtime/helpers/inherits");var R=e.n(x),O=function(){return m()((function e(t){v()(this,e),this.model=t}),[{key:"create",value:function(e){return this.model.create(e)}},{key:"update",value:function(e,t){return this.model.findByIdAndUpdate(e,t,{new:!0})}},{key:"delete",value:function(e){return this.model.findByIdAndDelete(e)}},{key:"findById",value:function(e){return this.model.findById(e)}},{key:"findAll",value:function(){return this.model.find()}},{key:"findOne",value:function(e){return this.model.findOne(e)}},{key:"find",value:function(e){return this.model.find(e)}},{key:"count",value:function(e){return this.model.countDocuments(e)}},{key:"aggregate",value:function(e){return this.model.aggregate(e)}},{key:"createMany",value:function(e){return this.model.insertMany(e)}},{key:"updateMany",value:function(e,t){return this.model.updateMany(e,t)}},{key:"bulkWrite",value:function(e){return this.model.bulkWrite(e)}},{key:"upsert",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",this.create(r));case 5:return e.abrupt("return",this.update(n._id,r));case 6:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e}();const q=require("mongoose");var C=e.n(q),E=new(C().Schema)({email:{type:String,trim:!0,required:!0},phoneNumber:{type:String}},{_id:!1}),I=new q.Schema({code:{type:String,default:null},time:{type:Date,default:null}},{_id:!1}),T=new q.Schema({refresh:{type:String},createdAt:{type:Date,default:Date.now,expires:"15d"}},{_id:!1}),F=new q.Schema({fullName:{type:String,required:!0,trim:!0},profileImage:{type:String},password:{type:String,required:!0,trim:!0},contact:E,token:T,passwordResetCodeSchema:I,role:{type:q.Schema.Types.Number,ref:"Role",required:!0}},{collection:"users",timestamps:!0});const _=C().model("User",F);function j(e,t,r){return t=S()(t),b()(e,N()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function N(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(N=function(){return!!e})()}var A=function(e){function t(){return v()(this,t),j(this,t,[_])}return R()(t,e),m()(t)}(O);const B=require("bcrypt");function P(e){return D.apply(this,arguments)}function D(){return(D=r()(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.genSalt(10);case 2:return r=e.sent,e.abrupt("return",B.hash(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=function(){return m()((function e(t,r){v()(this,e),this.userRepository=t,this.roleRepository=r}),[{key:"createAdmin",value:(e=r()(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userRepository.findOne({role:1});case 2:if(e.sent){e.next=8;break}return e.next=6,P("baktaradmin");case 6:return t=e.sent,e.abrupt("return",this.userRepository.create({email:"baktaradmin@gmail.com",fullName:"baktar admin",password:t,role:1}));case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e}();const H=require("http-status-codes");var U=function(){function e(t){v()(this,e),this.success=t.success,this.status=t.status,this.message=t.message,this.data=t.data,this.details=t.details}return m()(e,null,[{key:"success",value:function(t){var r=t.status,n=void 0===r?H.StatusCodes.OK:r,s=t.message,i=t.data;return new e({success:!0,status:n,message:s||(0,H.getReasonPhrase)(n),data:i})}},{key:"error",value:function(t){var r=t.message,n=t.status,s=void 0===n?H.StatusCodes.BAD_REQUEST:n,i=t.details,o=void 0===i?null:i;return new e({success:!1,status:s,message:r||(0,H.getReasonPhrase)(s),details:o})}}])}(),W=function(){return m()((function e(t){v()(this,e),this.userRepository=t}),[{key:"create",value:(i=r()(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findByEmail(t.contact.email);case 2:if(!e.sent){e.next=5;break}throw new U.error({message:"Email is already in use",status:H.StatusCodes.CONFLICT});case 5:return e.next=7,P(t.password);case 7:return t.password=e.sent,e.abrupt("return",this.userRepository.create(t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"findByEmail",value:(n=r()(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.userRepository.findOne({"contact.email":t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"findById",value:(t=r()(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userRepository.findById(t);case 2:if(r=e.sent){e.next=5;break}throw U.error({status:H.StatusCodes.NOT_FOUND,message:"User not found!"});case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"update",value:(e=r()(s().mark((function e(t,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findById(t);case 2:return e.abrupt("return",this.userRepository.update(t,r));case 3:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t,n,i}(),J="user-service",K="user-repository";g.register(K,[],(function(){return new A})),g.register("user-seeder",[K],(function(e){return new M(e)})),g.register(J,[K],(function(e){return new W(e)}));var L=m()((function e(t){var r=t.contact,n=t.location,s=t.title,i=t.copyright,o=t.openingDay,u=t.openingHour,a=t.socialMedia;v()(this,e),Object.assign(this,{contact:r,location:n,title:s,copyright:i,openingDay:o,openingHour:u,socialMedia:a})})),G=function(){return m()((function e(t){v()(this,e),this.foooterService=t}),[{key:"find",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.foooterService.find();case 2:n=e.sent,r.success({message:"Find Footer successfully!",status:H.StatusCodes.OK,data:n?new L(n):null});case 4:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e}(),Q=new(C().Schema)({href:{type:String,require:!0},title:{type:String},url:{type:String,required:!0},publicId:{type:String,required:!0},type:{type:String},size:{type:Number}},{_id:!1}),V=new q.Schema({contact:E,location:{type:String,required:!0},title:{type:String,required:!0},copyright:{type:String,required:!0},openingDay:{type:String,required:!0},openingHour:{type:String,required:!0},socialMedia:[Q]},{collection:"footer",timestamps:!0});const X=C().model("Footer",V);function z(e,t,r){return t=S()(t),b()(e,Y()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Y=function(){return!!e})()}var Z=function(e){function t(){return v()(this,t),z(this,t,[X])}return R()(t,e),m()(t)}(O),$=function(){return m()((function e(t,r){v()(this,e),this.footerRepository=t,this.storageService=r}),[{key:"create",value:(n=r()(s().mark((function e(t,r){var n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.footerRepository.findAll();case 2:if(n=e.sent,i=[],!(n.length>0)){e.next=6;break}throw U.error({status:H.StatusCodes.CONFLICT,message:"Footer already exists !"});case 6:if(!(r&&r.length>0)){e.next=10;break}return e.next=9,this.storageService.uploadFiles(r);case 9:i=e.sent;case 10:return t.socialMedia=i,e.abrupt("return",this.footerRepository.createFooter(t));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"find",value:(t=r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.footerRepository.findAll()[0]);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"update",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.footerRepository.find()[0];case 2:if(n=e.sent){e.next=5;break}throw U.error({status:H.StatusCodes.NOT_FOUND,message:"Footer not found !"});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t,n}(),ee="footer-service",te="footer-repository",re="footer-controller";g.register(te,[],(function(){return new Z})),g.register(ee,[te],(function(e){return new $(e)})),g.register(re,[ee],(function(e){return new G(e)}));const ne=require("@babel/runtime/helpers/defineProperty");var se=e.n(ne);function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){se()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=new q.Schema({role:{type:String,unique:!0,required:!0,trim:!0}},{collection:"roles",versionKey:!1}).plugin((function(e,t){if(!t.incField)throw new Error("Please specify incField!");var n={type:Number};"_id"!==t.incField&&(n=oe(oe({},n),{},{unique:!0})),e.add(se()({},t.incField,n)),e.pre("save",(function(e){var r=this;this.isNew?this.constructor.findOne({},{},{sort:se()({},t.incField,-1)}).then((function(n){r[t.incField]=n?n[t.incField]+1:1,e()})):e()})),e.pre("insertMany",function(){var e=r()(s().mark((function e(r,n){var i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({},{},{sort:se()({},t.incField,-1)});case 2:i=e.sent,o=i?i[t.incField]:0,n.forEach((function(e,r){e[t.incField]=o+r+1})),r();case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}())}),{incField:"_id"});const ae=C().model("Role",ue);function ce(e,t,r){return t=S()(t),b()(e,pe()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function pe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(pe=function(){return!!e})()}var fe=function(e){function t(){return v()(this,t),ce(this,t,[ae])}return R()(t,e),m()(t)}(O),le=[{role:"admin"},{role:"user"}],he=function(){return m()((function e(t){v()(this,e),this.roleRepository=t}),[{key:"createRoles",value:(e=r()(s().mark((function e(){var t,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roleRepository.findAll();case 2:if(t=e.sent,r=t.map((function(e){return e.role})),!((n=le.filter((function(e){return!r.includes(e.role)}))).length>0)){e.next=8;break}return e.next=8,this.roleRepository.createMany(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e}(),de="role-repository";g.register(de,[],(function(){return new fe})),g.register("role-seeder",[de],(function(e){return new he(e)}));var ve=m()((function e(t){var r=t.email,n=t.phoneNumber;v()(this,e),Object.assign(this,{email:r,phoneNumber:n})})),ye=m()((function e(t){v()(this,e),this.fullName=t.fullName,this.profileImage=t.profileImage,this.role=t.role,this.contact=new ve(t.contact)})),me=m()((function e(t){v()(this,e),this.access=t.accessToken,this.refresh=t.refreshToken})),ge=m()((function e(t){v()(this,e),this.token=new me(t.token),this.user=new ye(t.user)})),we=function(){return m()((function e(t){v()(this,e),this.authService=t}),[{key:"register",value:(t=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.register(t.body);case 2:n=e.sent,r.success({message:"User register success",status:H.StatusCodes.CREATED,data:new ge(n)});case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"login",value:(e=r()(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.login(t.body);case 2:n=e.sent,r.success({message:"User Login  success",status:H.StatusCodes.OK,data:new ge(n,"")});case 5:case"end":return e.stop()}}),e,this)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t}();const be=require("jsonwebtoken");var ke=e.n(be),Se=function(e,t,r){return ke().sign(e,t,{expiresIn:r,algorithm:"HS512"})},xe={jwt:{algorithm:process.env.JWT_ALGORITHM,accessSecret:process.env.JWT_ACCESS_SECRET,accessExpiresIn:process.env.JWT_ACCESS_EXPIRES_IN,refreshSecret:process.env.JWT_REFRESH_SECRET,refreshExpiresIn:process.env.JWT_REFRESH_EXPIRES_IN}},Re=function(){return m()((function e(t){v()(this,e),this.userService=t}),[{key:"register",value:(t=r()(s().mark((function e(t){var r,n,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.role=2,e.next=3,this.userService.create(t);case 3:return r=e.sent,n={sub:r._id,email:r.contact.email},e.next=7,this.createToken(n);case 7:return i=e.sent,e.abrupt("return",{user:r,token:i});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"createToken",value:(e=r()(s().mark((function e(t){var r,n,i,o,u,a,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r=xe.jwt).accessSecret,i=r.accessExpiresIn,o=r.refreshSecret,u=r.refreshExpiresIn,e.next=3,Se(t,n,i);case 3:return a=e.sent,e.next=6,Se(t,o,u);case 6:return c=e.sent,e.next=9,this.userService.update(t.sub,{token:{refresh:c}});case 9:return e.abrupt("return",{accessToken:a,refreshToken:c});case 10:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),Oe="auth-controller",qe="auth-service";g.register(qe,[J],(function(e){return new Re(e)})),g.register(Oe,[qe],(function(e){return new we(e)}));const Ce=require("cookie-parser");var Ee=e.n(Ce);const Ie=require("cors");var Te=e.n(Ie);const Fe=require("express");var _e=e.n(Fe);const je=require("express-rate-limit");var Ne=_e().Router(),Ae="/auth",Be=g.get(Oe);Ne.post("".concat(Ae,"/login"),(function(e,t){return Be.login(e,t)})),Ne.post("".concat(Ae,"/register"),(function(e,t){return Be.register(e,t)}));const Pe=Ne;var De=_e().Router(),Me=g.get(re);De.get("".concat("/footers"),(function(e,t){return Me.find(e,t)}));const He=De;var Ue="/api/v1";const We=require("@babel/runtime/helpers/wrapNativeSuper");function Je(e,t,r){return t=S()(t),b()(e,Ke()?Reflect.construct(t,r||[],S()(e).constructor):t.apply(e,r))}function Ke(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ke=function(){return!!e})()}var Le=function(e){function t(e,r){var n;return v()(this,t),(n=Je(this,t,[e])).statusCode=r,n}return R()(t,e),m()(t)}(e.n(We)()(Error));var Ge=_e()();Ge.use((0,je.rateLimit)({windowMs:6e5,limit:100,standardHeaders:"draft-6",legacyHeaders:!1,message:"Too many requests"})),Ge.set("trust proxy",1),Ge.use(Ee()()),Ge.use(_e().urlencoded({extended:!0})),Ge.use(_e().json()),Ge.use(Te()()),Ge.disable("x-powered-by"),Ge.use((function(e,t,r){t.success=function(e){t.status(e.status||H.StatusCodes.OK).json(U.success(e))},t.error=function(e){t.status(e.status||H.StatusCodes.BAD_REQUEST).json(U.error(e))},r()})),Ge.use("/api-docs",p().serve,p().setup(f)),Ge.use(Ue,He),Ge.use(Ue,Pe),Ge.use((function(e,t,r,n){return e instanceof Le?r.status(e.statusCode||400).json({success:!1,message:e.message}):(n(),e instanceof U?r.error(e):r.status(500).json({success:!1,message:e.message||"Internal Server Error!"}))}));const Qe=Ge;function Ve(){return Xe.apply(this,arguments)}function Xe(){return(Xe=r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C().connect(process.env.CONNECTION_STRING);case 3:console.log("MongoDB Connected"),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.error("MongoDB Connection Error:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var ze=function(){var e=r()(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new M(g.get(K)),r=new he(g.get(de)),e.next=4,r.createRoles();case 4:return e.next=6,Promise.all([t.createAdmin()]);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ye=(0,o.createServer)(Qe),Ze=process.env.PORT;r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve();case 2:return e.next=4,ze();case 4:Ye.listen(Ze,r()(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Server is running: http://localhost:".concat(Ze));case 1:case"end":return e.stop()}}),e)}))));case 5:case"end":return e.stop()}}),e)})))()})();
//# sourceMappingURL=build.js.map